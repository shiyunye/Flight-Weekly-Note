--Data Consolidated Table 

SELECT wk_starting,
wk_ending,
trip_direction,
Company,
brand,
Product, 

Carrier_Name as Carrier_Detail,
case when Carrier_Name like '%(AA)%'then Carrier_Name
when Carrier_Name like '%(DL)%' then Carrier_Name
when Carrier_Name like '%(UA)%' then Carrier_Name
when Carrier_Name like '%(NK)%' then Carrier_Name
when Carrier_Name like '%(F9)%' then Carrier_Name
when Carrier_Name like '%(AS)%' then Carrier_Name
when Carrier_Name like '%(B6)%' then Carrier_Name else 'Other' end as Carrier,
Offer_Method_Code,
Source as Source,
source_group,
application_group as application,
Fare_Type,
fare_type_group,
GDS_Booking_Name,
GDS_Bkng_Name_Group as GDS_Bkng_Name_Grp,

merchant_of_record as MOR_Detail,
case when merchant_of_record like 'AGENCY' then merchant_of_record
when merchant_of_record like 'PCLN' then merchant_of_record
when merchant_of_record like 'VCC' then merchant_of_record else '' end as merchant_of_record,

domint,
orig_country,
case when orig_country like 'United States'then 'US Origin' else 'Intl Origin' end as Orig_Country_Group,

POS_ISO_COUNTRY_NAME,
finance_filter,

case when PLF_CODE = 'FFBKNG' then 'Project Mercury'
  when PLF_CODE = 'BKNGWL' then 'Booking WL'
  else '' end  as PLF_Group,

sum(ly_curr_tickets) AS Net_tkts_LY,
sum(cy_curr_tickets) AS Net_tkts_CY,
sum(ly_curr_tickets)-sum(cy_curr_tickets) AS YoY_Tkts,
sum(ly_tickets) AS Gr_tkts_LY,
sum(cy_tickets) AS Gr_tkts_CY,
sum(ly_tickets)-sum(cy_tickets) AS YoY_Gr_Tkts,


sum(ly_normalized_gr_tickets) as normalized_gross_tickets_ly,
sum(cy_normalized_gr_tickets) as normalized_gross_tickets_cy,
sum(ly_normalized_gr_tickets)-sum(cy_normalized_gr_tickets) as YoY_normalized_gross_tickets,

sum(ly_normalized_net_tickets) as normalized_net_tickets_ly,
sum(cy_normalized_net_tickets) as normalized_net_tickets_cy,
sum(ly_normalized_net_tickets)-sum(cy_normalized_net_tickets) as YoY_normalized_net_tickets,

sum(ly_gross_contribution) as gross_contribution_ly,
sum(cy_gross_contribution) as gross_contribution_cy,
sum(ly_gross_contribution)-sum(cy_gross_contribution) as YoY_gross_contribution,

sum(ly_net_contribution) as net_contribution_ly,
sum(cy_net_contribution) as net_contribution_cy,
sum(ly_net_contribution)-sum(cy_net_contribution) as YoY_net_contribution,


sum(ly_gr_contr_fee) as gr_contr_fee_ly,
sum(cy_gr_contr_fee) as gr_contr_fee_cy,
sum(ly_gr_contr_fee)-sum(cy_gr_contr_fee) as YoY_gr_contr_fee,


sum(ly_net_contr_fee) as net_contr_fee_ly,
sum(cy_net_contr_fee) as net_contr_fee_cy,
sum(ly_net_contr_fee)-sum(cy_net_contr_fee) as YoY_net_contr_fee


FROM `pcln-pl-airanalytics-prod.flight_performance.PL_Offer_View`
where 
wk_ending>=current_date()-15
and
wk_ending<current_date()-1
and GDS_Bkng_Name_Group <> 'Phone Sales'
--and  Company like 'Priceline%'
group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24
order by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24